<div class="container">
    <div class="header-actions">
        <h2>Nuestros Productos F1</h2>
        <a href="/carts/6893def890c787ca530f7d3b" class="btn-view-cart">
            <i class="fas fa-shopping-cart"></i> Ver Carrito
        </a>
    </div>

    <div class="filters">
        <form method="GET" action="/" class="filter-form">

            <select name="query[category]" onchange="this.form.submit()">
                <option value="">Todas las categorías</option>
                <option value="Monoplazas" {{#if (eq query.category "Monoplazas" )}}selected{{/if}}>Monoplazas</option>
                <option value="Pilotos" {{#if (eq query.category "Pilotos" )}}selected{{/if}}>Pilotos</option>
                <option value="Circuitos" {{#if (eq query.category "Circuitos" )}}selected{{/if}}>Circuitos</option>
            </select>

            <select name="query[status]" onchange="this.form.submit()">
                <option value="">Todos los estados</option>
                <option value="true" {{#if (eq query.status "true" )}}selected{{/if}}>Disponibles</option>
                <option value="false" {{#if (eq query.status "false" )}}selected{{/if}}>No disponibles</option>
            </select>

            <select name="sort" onchange="this.form.submit()">
                <option value="">Sin ordenar</option>
                <option value="asc" {{#if (eq sort "asc" )}}selected{{/if}}>Precio: Menor a Mayor</option>
                <option value="desc" {{#if (eq sort "desc" )}}selected{{/if}}>Precio: Mayor a Menor</option>
            </select>

            <div class="price-filters">
                <input type="number" name="query[minPrice]" placeholder="Precio mín." value="{{query.minPrice}}" min="0"
                    step="0.01">
                <input type="number" name="query[maxPrice]" placeholder="Precio máx." value="{{query.maxPrice}}" min="0"
                    step="0.01">
            </div>

            <div class="search-section">
                <input type="text" name="query[search]" placeholder="Buscar productos..." value="{{query.search}}">
                <button type="submit" class="btn-search">
                    <i class="fas fa-search"></i> Buscar
                </button>
            </div>

            <a href="/" class="btn-clear-filters">
                <i class="fas fa-times"></i> Limpiar filtros
            </a>
        </form>
    </div>

    <div class="products-grid">
        {{#each products}}
        <div class="product-card">
            {{#if imageUrl}}
            <img src="{{imageUrl}}" alt="{{title}}" loading="lazy" class="product-image"
                onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            {{/if}}
            {{#unless imageUrl}}
            <div class="product-placeholder"><i class="fas fa-image"></i></div>
            {{/unless}}
            <div class="product-placeholder" style="display: none;"></div>

            <h3>{{title}}</h3>
            <p>{{description}}</p>
            <p><strong>Precio:</strong> ${{price}}</p>
            <p><strong>Categoría:</strong> {{category}}</p>
            <p><strong>Estado:</strong> {{#if status}} Disponible {{else}} No disponible {{/if}}</p>

            <div class="product-actions">
                <a href="/products/{{_id}}" class="btn-view-details">Ver Detalles</a>
                {{#if status}}
                <button onclick="addToCart('{{_id}}')" class="btn-add-cart">Agregar al Carrito</button>
                {{/if}}
            </div>
        </div>
        {{/each}}
    </div>

    {{#if pagination}}
    <div class="pagination">
        {{#if pagination.hasPrevPage}}
        <a href="{{pagination.prevLink}}" class="btn-page">
            <i class="fas fa-chevron-left"></i> Anterior
        </a>
        {{/if}}

        <span class="page-info">
            Página {{pagination.page}} de {{pagination.totalPages}}
        </span>

        {{#if pagination.hasNextPage}}
        <a href="{{pagination.nextLink}}" class="btn-page">
            Siguiente <i class="fas fa-chevron-right"></i>
        </a>
        {{/if}}
    </div>
    {{/if}}
</div>

<script src="/js/productActions.js"></script>